From b20ffd9d1e34e19a6b071208de62c8fb34bace3c Mon Sep 17 00:00:00 2001
From: Hiroshi Shirosaki <h.shirosaki@gmail.com>
Date: Tue, 1 Jul 2014 10:03:34 +0900
Subject: [PATCH 1/3] job.c-set_child_handler_action_flags-SV-41341

https://github.com/Alexpux/MSYS2-packages/blob/master/make/0001-job.c-set_child_handler_action_flags-SV-41341.patch
---
 job.c | 18 ++++++++++++++----
 1 file changed, 14 insertions(+), 4 deletions(-)

diff --git a/job.c b/job.c
index febfac0..7b061a6 100644
--- a/job.c
+++ b/job.c
@@ -1108,10 +1108,20 @@ set_child_handler_action_flags (int set_handler, int set_alarm)
       /* If we're about to enter the read(), set an alarm to wake up in a
          second so we can check if the load has dropped and we can start more
          work.  On the way out, turn off the alarm and set SIG_DFL.  */
-      alarm (set_handler ? 1 : 0);
-      sa.sa_handler = set_handler ? job_noop : SIG_DFL;
-      sa.sa_flags = 0;
-      sigaction (SIGALRM, &sa, NULL);
+      if (set_handler)
+        {
+          sa.sa_handler = job_noop;
+          sa.sa_flags = 0;
+          sigaction (SIGALRM, &sa, NULL);
+          alarm (1);
+        }
+      else
+        {
+          alarm (0);
+          sa.sa_handler = SIG_DFL;
+          sa.sa_flags = 0;
+          sigaction (SIGALRM, &sa, NULL);
+        }
     }
 #endif
 }
-- 
2.0.0

